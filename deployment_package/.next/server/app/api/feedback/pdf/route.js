(()=>{var e={};e.id=260,e.ids=[260],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},5511:e=>{"use strict";e.exports=require("crypto")},4735:e=>{"use strict";e.exports=require("events")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},1645:e=>{"use strict";e.exports=require("net")},1997:e=>{"use strict";e.exports=require("punycode")},7910:e=>{"use strict";e.exports=require("stream")},4631:e=>{"use strict";e.exports=require("tls")},9551:e=>{"use strict";e.exports=require("url")},4075:e=>{"use strict";e.exports=require("zlib")},3076:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>d,serverHooks:()=>w,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>l});var i=t(5367),o=t(9088),n=t(3807),a=t(4070);async function c(e,r){try{var t,s;return t=e,s=r,t.overallScore,s.jobTitle,s.company,new Date().toLocaleDateString(),t.summary,t.strengths.map(e=>`<li class="strength">${e}</li>`).join(""),t.areasForImprovement.map(e=>`<li class="improvement">${e}</li>`).join(""),function(e){e.map(e=>{let r=e.score>=8?"#22c55e":e.score>=6?"#f59e0b":"#ef4444";return`
      <div class="question-feedback">
        <div class="question-text">
          <span class="question-score" style="background-color: ${r}; color: white;">${Math.round(e.score)}</span>
          ${e.question}
        </div>
        
        <div>
          <strong>Strengths:</strong>
          <ul>
            ${e.strengths.map(e=>`<li class="feedback-item">${e}</li>`).join("")}
          </ul>
        </div>
        
        <div>
          <strong>Areas to Improve:</strong>
          <ul>
            ${e.weaknesses.map(e=>`<li class="feedback-item">${e}</li>`).join("")}
          </ul>
        </div>
        
        <div class="soar-box">
          <div class="soar-title">SOAR Method Improvement</div>
          <p>${e.improvement}</p>
        </div>
      </div>
    `}).join("")}(t.questionFeedback),t.nextSteps.map(e=>`<li>${e}</li>`).join(""),new Date().getFullYear(),console.log("Generating PDF from HTML content..."),await new Promise(e=>setTimeout(e,2e3)),Buffer.from("Simulated PDF content")}catch(e){throw console.error("Error generating PDF:",e),Error("Failed to generate PDF")}}var u=t(7258);async function l(e){try{let r=await (0,u.HW)();if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{reportId:t,report:s,jobData:i}=await e.json();if(!t||!s||!i)return a.NextResponse.json({error:"Missing required fields"},{status:400});let o=await c(s,i),n=`feedback_pdfs/${r.id}/${t}.pdf`,l=await (0,u.GP)("feedback_pdfs",n,o);if(!l)throw Error("Failed to upload PDF");return await p(t,l),a.NextResponse.json({success:!0,pdfUrl:l})}catch(e){return console.error("Error generating PDF:",e),a.NextResponse.json({error:"Failed to generate PDF"},{status:500})}}async function p(e,r){let{supabaseAdmin:s}=await Promise.resolve().then(t.bind(t,7258));await s.from("feedback_reports").update({pdf_path:r}).eq("id",e)}let d=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/feedback/pdf/route",pathname:"/api/feedback/pdf",filename:"route",bundlePath:"app/api/feedback/pdf/route"},resolvedPagePath:"/home/ubuntu/mock_interview_bot/mock_interview_bot/src/app/api/feedback/pdf/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:m,serverHooks:w}=d;function h(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:m})}},5276:()=>{},2124:()=>{},7258:(e,r,t)=>{"use strict";t.d(r,{$A:()=>d,GP:()=>h,HW:()=>c,Ij:()=>l,Kh:()=>p,Tt:()=>u,Wh:()=>w,st:()=>m,supabaseAdmin:()=>a,t9:()=>f});var s=t(1028);let i="https://snhezroznzsjcqqxpjpp.supabase.co",o=(0,s.UU)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNuaGV6cm96bnpzamNxcXhwanBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU2OTM0NDcsImV4cCI6MjA2MTI2OTQ0N30.KyySx7uxtC_GRB_NF9DYCA9N350ajZ1uQ6hvYDkHiLY"),n=process.env.SUPABASE_SERVICE_ROLE_KEY||"your-service-key",a=(0,s.UU)(i,n);async function c(){try{let{data:e,error:r}=await o.auth.getUser();if(r)throw r;return e.user}catch(e){return console.error("Error getting current user:",e),null}}async function u(e,r,t,s,i,o){try{let{data:n,error:c}=await a.from("job_descriptions").insert({user_id:e,title:r,company:t,content:s,parsed_data:i,file_name:o?.fileName,file_type:o?.fileType,file_size:o?.fileSize,storage_path:o?.storagePath}).select().single();if(c)throw c;return n}catch(e){return console.error("Error storing job description:",e),null}}async function l(e,r,t){try{let{data:s,error:i}=await a.rpc("check_session_limits",{user_uuid:e});if(i)throw i;if(!s.allowed)throw Error("Daily session limit reached");let{data:o,error:n}=await a.from("interview_sessions").insert({user_id:e,job_description_id:r,status:"in_progress",questions:t,answers:{},analyses:{}}).select().single();if(n)throw n;return await a.rpc("increment_session_count",{user_uuid:e}),o}catch(e){return console.error("Error creating interview session:",e),null}}async function p(e,r,t,s){try{let{data:i,error:o}=await a.from("interview_sessions").select("answers, analyses").eq("id",e).single();if(o)throw o;let n={...i.answers,[r]:t},c={...i.analyses,[r]:s},{data:u,error:l}=await a.from("interview_sessions").update({answers:n,analyses:c}).eq("id",e).select().single();if(l)throw l;return u}catch(e){return console.error("Error updating session answer:",e),null}}async function d(e){try{let{data:r,error:t}=await a.from("interview_sessions").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",e).select().single();if(t)throw t;return r}catch(e){return console.error("Error completing interview session:",e),null}}async function f(e,r,t,s,i){try{let{data:o,error:n}=await a.from("feedback_reports").insert({session_id:e,user_id:r,report_data:t,overall_score:s,pdf_path:i}).select().single();if(n)throw n;return o}catch(e){return console.error("Error storing feedback report:",e),null}}async function m(e,r,t,s,i){try{let o=1e-5*s,n=3e-5*i,{data:c,error:u}=await a.from("token_usage").insert({user_id:e,session_id:r,endpoint:t,prompt_tokens:s,completion_tokens:i,total_tokens:s+i,cost:o+n}).select().single();if(u)throw u;let{data:l,error:p}=await a.rpc("check_token_limit");if(p)throw p;return l&&l.limit_reached&&await a.from("global_settings").update({value:"false"}).eq("key","ALLOW_OPENAI_CALLS"),c}catch(e){return console.error("Error tracking token usage:",e),null}}async function w(){try{let{data:e,error:r}=await a.from("global_settings").select("value").eq("key","ALLOW_OPENAI_CALLS").single();if(r)throw r;return"true"===e.value}catch(e){return console.error("Error checking circuit breaker:",e),!1}}async function h(e,r,t){try{let{data:s,error:i}=await a.storage.from(e).upload(r,t,{contentType:"application/pdf",cacheControl:"3600",upsert:!1});if(i)throw i;let{data:o}=a.storage.from(e).getPublicUrl(s.path);return o.publicUrl}catch(e){return console.error("Error uploading PDF:",e),null}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[803,654,28],()=>t(3076));module.exports=s})();