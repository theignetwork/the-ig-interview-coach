(()=>{var e={};e.id=64,e.ids=[64],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},5511:e=>{"use strict";e.exports=require("crypto")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},1645:e=>{"use strict";e.exports=require("net")},3873:e=>{"use strict";e.exports=require("path")},1997:e=>{"use strict";e.exports=require("punycode")},7910:e=>{"use strict";e.exports=require("stream")},4631:e=>{"use strict";e.exports=require("tls")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},3566:e=>{"use strict";e.exports=require("worker_threads")},4075:e=>{"use strict";e.exports=require("zlib")},3024:e=>{"use strict";e.exports=require("node:fs")},7075:e=>{"use strict";e.exports=require("node:stream")},7830:e=>{"use strict";e.exports=require("node:stream/web")},2437:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>d,serverHooks:()=>f,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{POST:()=>p});var i=t(5367),o=t(9088),n=t(3807),a=t(4070),u=t(434),c=t(7258);let l=new u.Ay({apiKey:process.env.OPENAI_API_KEY});async function p(e){try{let r=await (0,c.HW)();if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.formData(),s=t.get("audio"),i=t.get("sessionId");if(!s)return a.NextResponse.json({error:"No audio file provided"},{status:400});let o=await l.audio.transcriptions.create({file:s,model:"whisper-1",language:"en"}),n=Math.ceil(s.size/32e3);return await (0,c.st)(r.id,i||null,"transcribeAudio",n,0),a.NextResponse.json({text:o.text})}catch(e){return console.error("Error transcribing audio:",e),a.NextResponse.json({error:"Failed to transcribe audio"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/whisper/route",pathname:"/api/whisper",filename:"route",bundlePath:"app/api/whisper/route"},resolvedPagePath:"/home/ubuntu/mock_interview_bot/mock_interview_bot/src/app/api/whisper/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:h,serverHooks:f}=d;function _(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:h})}},5276:()=>{},2124:()=>{},7258:(e,r,t)=>{"use strict";t.d(r,{$A:()=>d,GP:()=>_,HW:()=>u,Ij:()=>l,Kh:()=>p,Tt:()=>c,Wh:()=>f,st:()=>h,supabaseAdmin:()=>a,t9:()=>w});var s=t(1028);let i="https://snhezroznzsjcqqxpjpp.supabase.co",o=(0,s.UU)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNuaGV6cm96bnpzamNxcXhwanBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU2OTM0NDcsImV4cCI6MjA2MTI2OTQ0N30.KyySx7uxtC_GRB_NF9DYCA9N350ajZ1uQ6hvYDkHiLY"),n=process.env.SUPABASE_SERVICE_ROLE_KEY||"your-service-key",a=(0,s.UU)(i,n);async function u(){try{let{data:e,error:r}=await o.auth.getUser();if(r)throw r;return e.user}catch(e){return console.error("Error getting current user:",e),null}}async function c(e,r,t,s,i,o){try{let{data:n,error:u}=await a.from("job_descriptions").insert({user_id:e,title:r,company:t,content:s,parsed_data:i,file_name:o?.fileName,file_type:o?.fileType,file_size:o?.fileSize,storage_path:o?.storagePath}).select().single();if(u)throw u;return n}catch(e){return console.error("Error storing job description:",e),null}}async function l(e,r,t){try{let{data:s,error:i}=await a.rpc("check_session_limits",{user_uuid:e});if(i)throw i;if(!s.allowed)throw Error("Daily session limit reached");let{data:o,error:n}=await a.from("interview_sessions").insert({user_id:e,job_description_id:r,status:"in_progress",questions:t,answers:{},analyses:{}}).select().single();if(n)throw n;return await a.rpc("increment_session_count",{user_uuid:e}),o}catch(e){return console.error("Error creating interview session:",e),null}}async function p(e,r,t,s){try{let{data:i,error:o}=await a.from("interview_sessions").select("answers, analyses").eq("id",e).single();if(o)throw o;let n={...i.answers,[r]:t},u={...i.analyses,[r]:s},{data:c,error:l}=await a.from("interview_sessions").update({answers:n,analyses:u}).eq("id",e).select().single();if(l)throw l;return c}catch(e){return console.error("Error updating session answer:",e),null}}async function d(e){try{let{data:r,error:t}=await a.from("interview_sessions").update({status:"completed",completed_at:new Date().toISOString()}).eq("id",e).select().single();if(t)throw t;return r}catch(e){return console.error("Error completing interview session:",e),null}}async function w(e,r,t,s,i){try{let{data:o,error:n}=await a.from("feedback_reports").insert({session_id:e,user_id:r,report_data:t,overall_score:s,pdf_path:i}).select().single();if(n)throw n;return o}catch(e){return console.error("Error storing feedback report:",e),null}}async function h(e,r,t,s,i){try{let o=1e-5*s,n=3e-5*i,{data:u,error:c}=await a.from("token_usage").insert({user_id:e,session_id:r,endpoint:t,prompt_tokens:s,completion_tokens:i,total_tokens:s+i,cost:o+n}).select().single();if(c)throw c;let{data:l,error:p}=await a.rpc("check_token_limit");if(p)throw p;return l&&l.limit_reached&&await a.from("global_settings").update({value:"false"}).eq("key","ALLOW_OPENAI_CALLS"),u}catch(e){return console.error("Error tracking token usage:",e),null}}async function f(){try{let{data:e,error:r}=await a.from("global_settings").select("value").eq("key","ALLOW_OPENAI_CALLS").single();if(r)throw r;return"true"===e.value}catch(e){return console.error("Error checking circuit breaker:",e),!1}}async function _(e,r,t){try{let{data:s,error:i}=await a.storage.from(e).upload(r,t,{contentType:"application/pdf",cacheControl:"3600",upsert:!1});if(i)throw i;let{data:o}=a.storage.from(e).getPublicUrl(s.path);return o.publicUrl}catch(e){return console.error("Error uploading PDF:",e),null}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[803,654,28,434],()=>t(2437));module.exports=s})();