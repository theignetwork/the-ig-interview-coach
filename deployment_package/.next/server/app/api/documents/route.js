"use strict";(()=>{var e={};e.id=220,e.ids=[220],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{e.exports=require("buffer")},5511:e=>{e.exports=require("crypto")},4735:e=>{e.exports=require("events")},9021:e=>{e.exports=require("fs")},1630:e=>{e.exports=require("http")},5591:e=>{e.exports=require("https")},1645:e=>{e.exports=require("net")},3873:e=>{e.exports=require("path")},1997:e=>{e.exports=require("punycode")},7910:e=>{e.exports=require("stream")},4631:e=>{e.exports=require("tls")},9551:e=>{e.exports=require("url")},8354:e=>{e.exports=require("util")},3566:e=>{e.exports=require("worker_threads")},4075:e=>{e.exports=require("zlib")},3024:e=>{e.exports=require("node:fs")},7075:e=>{e.exports=require("node:stream")},7830:e=>{e.exports=require("node:stream/web")},8485:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>q,routeModule:()=>w,serverHooks:()=>y,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>v});var o={};r.r(o),r.d(o,{POST:()=>h});var i=r(5367),s=r(9088),n=r(3807),a=r(4070);async function u(e,t){if("application/pdf"===t)return p(e);if("application/vnd.openxmlformats-officedocument.wordprocessingml.document"===t)return l(e);throw Error(`Unsupported file type: ${t}`)}async function p(e){try{return console.log("Extracting text from PDF file..."),await new Promise(e=>setTimeout(e,1e3)),"This is simulated extracted text from a PDF file. In the real implementation, this would be the actual content extracted from the PDF using PDF.js."}catch(e){throw console.error("Error extracting text from PDF:",e),Error("Failed to extract text from PDF file")}}async function l(e){try{return console.log("Extracting text from DOCX file..."),await new Promise(e=>setTimeout(e,1e3)),"This is simulated extracted text from a DOCX file. In the real implementation, this would be the actual content extracted from the DOCX using mammoth.js."}catch(e){throw console.error("Error extracting text from DOCX:",e),Error("Failed to extract text from DOCX file")}}function c(e){let t=e.replace(/\s+/g," ");return(t=t.replace(/[^\w\s.,;:?!()[\]{}'""-]/g,"")).trim()}let d=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],m=[".pdf",".docx"];var x=r(3710),f=r(7258);async function h(e){try{let t=await (0,f.HW)();if(!t)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.formData(),o=r.get("file"),i=r.get("text");if(i){if(i.length>5e4)return a.NextResponse.json({error:"Text is too long. Maximum length is 50,000 characters."},{status:413});let e=c(i),r=await (0,x.rm)(e,t.id),o=await (0,f.Tt)(t.id,r.jobTitle,r.company,e,r);if(!o)throw Error("Failed to store document");return a.NextResponse.json({success:!0,documentId:o.id,content:e,parsedData:r})}if(!o)return a.NextResponse.json({error:"No file or text provided"},{status:400});let s=function(e){let t=e.size>0x3200000?{valid:!1,error:`File size exceeds the maximum limit of 50MB. Your file is ${(e.size/1048576).toFixed(2)}MB.`}:{valid:!0};if(!t.valid)return t;let r=function(e){if(!d.includes(e.type)){let t=e.name.substring(e.name.lastIndexOf(".")).toLowerCase();if(!m.includes(t))return{valid:!1,error:"Invalid file type. Please upload a PDF or DOCX file."}}return{valid:!0}}(e);return r.valid?{valid:!0}:r}(o);if(!s.valid)return a.NextResponse.json({error:s.error},{status:400});let n=await o.arrayBuffer(),p=await u(n,o.type),l=c(p),h=await (0,x.rm)(l,t.id),w=await (0,f.Tt)(t.id,h.jobTitle,h.company,l,h,{fileName:o.name,fileType:o.type,fileSize:o.size,storagePath:`documents/${t.id}/${Date.now()}_${o.name}`});if(!w)throw Error("Failed to store document");return a.NextResponse.json({success:!0,documentId:w.id,fileName:o.name,fileType:o.type,fileSize:o.size,content:l,parsedData:h})}catch(e){return console.error("Error processing document:",e),a.NextResponse.json({error:"Failed to process document"},{status:500})}}let w=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/documents/route",pathname:"/api/documents",filename:"route",bundlePath:"app/api/documents/route"},resolvedPagePath:"/home/ubuntu/mock_interview_bot/mock_interview_bot/src/app/api/documents/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:g,workUnitAsyncStorage:v,serverHooks:y}=w;function q(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:v})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[803,654,28,434,558],()=>r(8485));module.exports=o})();